<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EmojiCrypt - Universal Secret Chat</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background: #09090b;
            color: #fafafa;
            background-image: radial-gradient(circle at 50% 0%, #1e1b4b 0%, #09090b 70%);
        }
        .glass-panel {
            background: rgba(18, 18, 21, 0.7);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        .input-area {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .input-area:focus-within {
            border-color: #6366f1;
            background: rgba(99, 102, 241, 0.05);
            box-shadow: 0 0 30px rgba(99, 102, 241, 0.15);
        }
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-slide { animation: slideUp 0.5s ease-out forwards; }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <div class="max-w-xl w-full space-y-8 animate-slide">
        <!-- Header -->
        <div class="text-center space-y-3">
            <h1 class="text-5xl font-black tracking-tighter bg-gradient-to-tr from-indigo-400 via-purple-400 to-pink-400 bg-clip-text text-transparent">
                EmojiCrypt
            </h1>
            <p class="text-zinc-400 text-sm font-medium">Universal secret messaging via invisible Unicode.</p>
        </div>

        <div class="glass-panel rounded-[2.5rem] p-6 md:p-10 shadow-3xl space-y-8">
            
            <!-- Tabs -->
            <div class="flex bg-zinc-900/80 p-1.5 rounded-2xl border border-zinc-800">
                <button id="tab-enc" onclick="switchTab('enc')" class="flex-1 py-3 rounded-xl bg-indigo-600 text-white font-bold transition-all shadow-lg">Encrypt</button>
                <button id="tab-dec" onclick="switchTab('dec')" class="flex-1 py-3 rounded-xl text-zinc-500 font-bold transition-all hover:text-zinc-300">Decrypt</button>
            </div>

            <!-- Global Password (Required only if encrypting with one) -->
            <div class="space-y-2">
                <label class="text-[10px] uppercase tracking-[0.2em] text-zinc-500 font-black ml-1">Universal Key (Optional)</label>
                <div class="input-area rounded-2xl flex items-center px-5">
                    <svg class="w-4 h-4 text-indigo-500 mr-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path></svg>
                    <input id="password" type="password" placeholder="Must be same on both devices..." class="w-full bg-transparent py-4 text-sm outline-none placeholder:text-zinc-700">
                </div>
            </div>

            <!-- Encrypt Section -->
            <div id="section-enc" class="space-y-6">
                <div class="space-y-2">
                    <div class="flex justify-between items-end">
                        <label class="text-[10px] uppercase tracking-[0.2em] text-zinc-500 font-black ml-1">Your Message</label>
                        <span id="count" class="text-[10px] text-zinc-600 font-mono">0 / 1500</span>
                    </div>
                    <div class="input-area rounded-[1.5rem]">
                        <textarea id="text-input" maxlength="1500" placeholder="Type a message that stays hidden..." 
                            class="w-full h-32 bg-transparent p-5 text-sm outline-none resize-none leading-relaxed"></textarea>
                    </div>
                </div>

                <div class="space-y-2">
                    <label class="text-[10px] uppercase tracking-[0.2em] text-zinc-500 font-black ml-1">Cover Emoji(s)</label>
                    <div class="input-area rounded-2xl">
                        <input id="cover-input" type="text" placeholder="Paste your favorite emojis from keyboard..." 
                            class="w-full bg-transparent px-5 py-4 text-2xl outline-none placeholder:text-sm placeholder:italic">
                    </div>
                    <p class="text-[10px] text-zinc-500 italic px-2">Data is hidden *behind* these emojis.</p>
                </div>

                <button onclick="encrypt()" class="w-full py-5 bg-indigo-600 hover:bg-indigo-500 text-white font-black text-sm uppercase tracking-widest rounded-[1.25rem] shadow-xl shadow-indigo-900/30 transition-all active:scale-[0.98]">
                    Generate Secret
                </button>
            </div>

            <!-- Decrypt Section -->
            <div id="section-dec" class="space-y-6 hidden">
                <div class="space-y-2">
                    <label class="text-[10px] uppercase tracking-[0.2em] text-zinc-500 font-black ml-1">Paste Received Emojis</label>
                    <div class="input-area rounded-[2rem]">
                        <textarea id="emoji-paste" placeholder="Paste the secret emoji string here..." 
                            class="w-full h-44 bg-transparent p-6 text-center text-3xl outline-none resize-none break-all flex items-center justify-center"></textarea>
                    </div>
                </div>

                <button onclick="decrypt()" class="w-full py-5 bg-emerald-600 hover:bg-emerald-500 text-white font-black text-sm uppercase tracking-widest rounded-[1.25rem] shadow-xl shadow-emerald-900/30 transition-all active:scale-[0.98]">
                    Unlock Message
                </button>
            </div>

            <!-- Result Display -->
            <div id="result-box" class="hidden pt-4 scale-up">
                <div class="bg-indigo-950/20 border border-indigo-500/20 rounded-3xl p-8 text-center space-y-6">
                    <div id="result-label" class="text-[10px] uppercase tracking-[0.4em] font-black text-indigo-400">Message Ready</div>
                    <div id="result-text" class="text-xl break-words select-all font-medium leading-relaxed text-zinc-100"></div>
                    
                    <div class="flex gap-3 justify-center">
                        <button onclick="copyResult()" class="px-6 py-3 bg-zinc-800 hover:bg-zinc-700 rounded-xl text-[10px] font-black uppercase tracking-widest transition-all">
                            Copy
                        </button>
                        <button id="share-btn" onclick="shareResult()" class="px-6 py-3 bg-indigo-600/20 hover:bg-indigo-600/40 text-indigo-400 rounded-xl text-[10px] font-black uppercase tracking-widest transition-all">
                            Share to Chat
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Instructions -->
        <div class="grid grid-cols-2 gap-4">
            <div class="glass-panel p-4 rounded-2xl text-center">
                <p class="text-indigo-400 font-bold text-xs mb-1">To Send</p>
                <p class="text-[9px] text-zinc-500 leading-tight">Encrypt, copy the emoji, and paste it into any chat app.</p>
            </div>
            <div class="glass-panel p-4 rounded-2xl text-center">
                <p class="text-emerald-400 font-bold text-xs mb-1">To Read</p>
                <p class="text-[9px] text-zinc-500 leading-tight">Copy the emoji from the chat and paste it here to decrypt.</p>
            </div>
        </div>
    </div>

    <div id="toast" class="fixed bottom-12 left-1/2 -translate-x-1/2 bg-white text-black px-8 py-4 rounded-2xl text-xs font-black shadow-2xl transition-all opacity-0 scale-90 pointer-events-none z-50">
        Copied!
    </div>

    <script>
        // Zero-width characters for Base-4 encoding
        const ZW = ['\u200B', '\u200C', '\u200D', '\u200E']; 

        document.getElementById('text-input').addEventListener('input', (e) => {
            document.getElementById('count').innerText = `${e.target.value.length} / 1500`;
        });

        function switchTab(mode) {
            const isEnc = mode === 'enc';
            document.getElementById('section-enc').classList.toggle('hidden', !isEnc);
            document.getElementById('section-dec').classList.toggle('hidden', isEnc);
            
            document.getElementById('tab-enc').className = isEnc ? 'flex-1 py-3 rounded-xl bg-indigo-600 text-white font-bold transition-all shadow-lg' : 'flex-1 py-3 rounded-xl text-zinc-500 font-bold transition-all hover:text-zinc-300';
            document.getElementById('tab-dec').className = !isEnc ? 'flex-1 py-3 rounded-xl bg-emerald-600 text-white font-bold transition-all shadow-lg' : 'flex-1 py-3 rounded-xl text-zinc-500 font-bold transition-all hover:text-zinc-300';
            
            document.getElementById('result-box').classList.add('hidden');
        }

        async function encrypt() {
            let text = document.getElementById('text-input').value;
            const pass = document.getElementById('password').value;
            const covers = Array.from(document.getElementById('cover-input').value || "ðŸ¤«");
            
            if (!text) return toast("Please enter a secret message.");

            try {
                // If password exists, encrypt the raw string first
                if (pass) text = "ENC:" + await encryptData(text, pass);

                // Use TextEncoder for universal character support (UTF-8)
                const encoder = new TextEncoder();
                const bytes = encoder.encode(text);
                
                // Convert bytes to Binary, then to Base-4
                let bin = "";
                bytes.forEach(b => bin += b.toString(2).padStart(8, '0'));
                
                let base4 = "";
                for(let i=0; i<bin.length; i+=2) base4 += parseInt(bin.substr(i,2), 2);

                // Map Base-4 digits to Zero-Width Characters
                let hidden = base4.split('').map(d => ZW[parseInt(d)]).join('');

                // Distribute data among all provided cover emojis
                let result = "";
                const chunkLen = Math.ceil(hidden.length / covers.length);
                for(let i=0; i<covers.length; i++) {
                    result += covers[i] + hidden.substr(i * chunkLen, chunkLen);
                }

                showResult("Secret Emoji Created", result);
                copyToClipboard(result);
            } catch(e) { 
                console.error(e);
                toast("Encryption Error"); 
            }
        }

        async function decrypt() {
            const input = document.getElementById('emoji-paste').value;
            const pass = document.getElementById('password').value;
            if (!input) return toast("Paste emojis from your chat.");

            // Extract ZW characters only
            let encoded = "";
            for (let char of input) {
                const idx = ZW.indexOf(char);
                if (idx !== -1) encoded += idx;
            }

            if (!encoded) return toast("No hidden message detected.");

            try {
                // Base-4 back to Binary
                let bin = encoded.split('').map(d => parseInt(d).toString(2).padStart(2, '0')).join('');
                
                // Binary back to Uint8Array
                let bytes = new Uint8Array(bin.length / 8);
                for(let i=0; i<bin.length; i+=8) {
                    bytes[i/8] = parseInt(bin.substr(i, 8), 2);
                }

                // Decode UTF-8
                let text = new TextDecoder().decode(bytes);

                // Handle password decryption if necessary
                if (text.startsWith("ENC:")) {
                    if (!pass) return toast("This message requires a password.");
                    text = await decryptData(text.replace("ENC:", ""), pass);
                }

                showResult("Message Decrypted", text);
            } catch(e) { 
                toast("Decryption failed. Wrong password?"); 
            }
        }

        // Crypto Engine (AES-GCM)
        async function encryptData(text, password) {
            const enc = new TextEncoder();
            const passKey = await crypto.subtle.digest('SHA-256', enc.encode(password));
            const key = await crypto.subtle.importKey('raw', passKey, 'AES-GCM', false, ['encrypt']);
            const iv = crypto.getRandomValues(new Uint8Array(12));
            const encrypted = await crypto.subtle.encrypt({ name: 'AES-GCM', iv }, key, enc.encode(text));
            const combined = new Uint8Array(iv.length + encrypted.byteLength);
            combined.set(iv); combined.set(new Uint8Array(encrypted), 12);
            return btoa(String.fromCharCode(...combined));
        }

        async function decryptData(data, password) {
            const enc = new TextEncoder();
            const combined = new Uint8Array(atob(data).split('').map(c => c.charCodeAt(0)));
            const iv = combined.slice(0, 12);
            const cipher = combined.slice(12);
            const passKey = await crypto.subtle.digest('SHA-256', enc.encode(password));
            const key = await crypto.subtle.importKey('raw', passKey, 'AES-GCM', false, ['decrypt']);
            const decrypted = await crypto.subtle.decrypt({ name: 'AES-GCM', iv }, key, cipher);
            return new TextDecoder().decode(decrypted);
        }

        // UI Logic
        function showResult(title, text) {
            const res = document.getElementById('result-box');
            document.getElementById('result-label').innerText = title;
            document.getElementById('result-text').innerText = text;
            res.classList.remove('hidden');
            res.scrollIntoView({ behavior: 'smooth' });
        }

        function copyToClipboard(text) {
            const el = document.createElement('textarea');
            el.value = text;
            document.body.appendChild(el);
            el.select();
            document.execCommand('copy');
            document.body.removeChild(el);
            toast("Copied & Ready to Send!");
        }

        function copyResult() {
            copyToClipboard(document.getElementById('result-text').innerText);
        }

        async function shareResult() {
            const text = document.getElementById('result-text').innerText;
            if (navigator.share) {
                try {
                    await navigator.share({ text: text });
                } catch (err) {}
            } else {
                copyResult();
            }
        }

        function toast(msg) {
            const t = document.getElementById('toast');
            t.innerText = msg;
            t.classList.replace('opacity-0', 'opacity-100');
            t.classList.replace('scale-90', 'scale-100');
            setTimeout(() => {
                t.classList.replace('opacity-100', 'opacity-0');
                t.classList.replace('scale-100', 'scale-90');
            }, 2500);
        }
    </script>
</body>
</html>

